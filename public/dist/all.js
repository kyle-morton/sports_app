var sportsNewsApp=angular.module("sportsNewsApp",["ngAnimate","app.routes","authService","mainCtrl","userCtrl","userService"]);sportsNewsApp.config(["$httpProvider",function(e){e.interceptors.push("AuthInterceptor")}]),angular.module("app.routes",["ngRoute"]).config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"app/views/pages/home.html"}).when("/login",{templateUrl:"app/views/pages/login.html",controller:"mainController",controllerAs:"login"}),t.html5Mode(!0)}]),angular.module("mainCtrl",[]).controller("mainController",["$rootScope","$location","$scope","Auth",function(e,t,o,n){var r=this;r.processing=!1,r.retrievedUser=!1,r.postData={},e.$on("$routeChangeStart",function(){r.loggedIn=n.isLoggedIn(),n.getUser().then(function(e){r.user=e.data})}),r.openLogin=function(){console.log("OPEN LOGIN!"),swal({title:"<b>Login</b>!",text:'<form ng-submit="login.doLogin()" ng-controller="userController as login"><div class="form-group"><input type="text" class="form-control" ng-model="login.loginData.username" placeholder="username..."></div><button type="submit" class="btn btn-primary text-center">Login</button></form>',showConfirmButton:!1,html:!0})},r.doLogin=function(){r.processing=!0,r.error="",r.loginData&&r.loginData.username&&r.loginData.password?n.login(r.loginData.username,r.loginData.password).success(function(e){r.processing=!1,e.success?t.path("/users"):r.error=e.message}):(r.processing=!1,r.error="Username & Password Required")},r.doLogout=function(){n.logout(),r.user={},t.path("/login")}}]),angular.module("userCtrl",["userService"]).controller("userController",["User","Post",function(e,t){console.log("USER CONTROLLER!");var o=this;o.processing=!0,o.processingPosts=!0,o.loadUsers=function(){e.all().success(function(e){o.processing=!1,o.users=e,o.users.length>=6?$("#userTableDiv").addClass("scrollTable"):$("#userTableDiv").removeClass("scrollTable")})},o.loadUsers(),o.deleteUser=function(t){swal({title:"Are you sure?",text:"You will not be able to recover this user!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!0,closeOnCancel:!0},function(){o.processing=!0,e["delete"](t).success(function(e){o.loadUsers()})})}}]).controller("userCreateController",["User",function(e){var t=this;t.type="create",t.roles=["admin","manager","user"],t.saveUser=function(){t.processing=!0,t.message="",console.log("Creating new user!"),e.create(t.userData).success(function(e){console.log("Created New User!"),t.processing=!1,t.userData={},t.message=e.message})}}]).controller("userEditController",["$routeParams","User",function(e,t){var o=this;o.type="edit",o.roles=["admin","manager","user"],t.get(e.user_id).success(function(e){o.userData=e}),o.saveUser=function(){o.processing=!0,o.message="",t.update(e.user_id,o.userData).success(function(e){o.processing=!1,o.userData={},o.message=e.message})}}]),angular.module("authService",[]).factory("Auth",["$http","$q","AuthToken",function(e,t,o){var n={};return n.login=function(t,n){return e.post("/api/authenticate",{username:t,password:n}).success(function(e){return o.setToken(e.token),e})},n.logout=function(){o.setToken()},n.isLoggedIn=function(){var e=!1;return o.getToken()&&(e=!0),e},n.getUser=function(){return o.getToken()?(console.log("token exists!"),e.get("/api/me")):t.reject({message:"User has no token."})},n}]).factory("AuthToken",["$window",function(e){var t={};return t.getToken=function(){return e.localStorage.getItem("token")},t.setToken=function(t){t?e.localStorage.setItem("token",t):e.localStorage.removeItem("token",t)},t}]).factory("AuthInterceptor",["$q","$location","AuthToken",function(e,t,o){var n={};return n.request=function(e){var t=o.getToken();return t&&(e.headers["x-access-token"]=t),e},n.responseError=function(e){403==e.status&&(o.setToken(),t.path("/login"))},n}]),angular.module("userService",[]).factory("User",["$http",function(e){var t={};return t.get=function(t){return e.get("/api/users/"+t)},t.all=function(){return e.get("/api/users/")},t.create=function(t){return e.post("/api/users/",t)},t.update=function(t,o){return e.put("/api/users/"+t,o)},t["delete"]=function(t){return e["delete"]("/api/users/"+t)},t}]);